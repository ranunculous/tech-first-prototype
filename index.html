<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tech-First Thinking™ for Airport Designers</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: "Avenir", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 2rem;
      max-width: 960px;
      margin-inline: auto;
      line-height: 1.5;
      background: #fafafa;
    }
    h1 {
      margin-bottom: 0.25rem;
    }
    h2 {
      margin-top: 2rem;
    }
    label {
      display: block;
      font-weight: 600;
      margin-top: 1rem;
    }
    input,
    textarea,
    select,
    button {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.25rem;
      font-size: 1rem;
      box-sizing: border-box;
      font-family: "Avenir", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }
    textarea {
      resize: vertical;
    }
    button {
      margin-top: 1.5rem;
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid #111;
      background: #111;
      color: #fff;
      font-weight: 600;
    }
    button:hover {
      opacity: 0.9;
    }
    .small {
      font-size: 0.9rem;
      color: #555;
    }
    #status {
      margin-top: 1rem;
      font-size: 0.95rem;
    }
    #output {
      margin-top: 2rem;
      white-space: pre-wrap;
      background: #f6f6f6;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 0.95rem;
    }
    .hidden {
      display: none;
    }
    .question-box {
      margin-top: 1.5rem;
      padding: 1rem;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    .question-label {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .divider {
      margin: 2.5rem 0 1.5rem;
      border: none;
      border-top: 1px solid #ddd;
    }
    .reports-list-item {
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: #fff;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
    .reports-list-item-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    .inline-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    .inline-buttons button {
      width: auto;
      margin-top: 0;
      padding-inline: 0.75rem;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <h1>Tech-First Thinking™ for Airport Designers</h1>
  <p class="small">
    This tool applies the Tech-First Thinking framework to airport projects to offer a more strategic approach to design.
    Enter your airport project details.
  </p>

  <!-- WHAT IS TECH-FIRST THINKING SECTION -->
  <section id="what-is">
    <h2>What is Tech-First Thinking?</h2>
    <p>
      Tech-First Thinking is a strategic design method for architects who refuse to work in the old order —
      the world where design begins with form and ends with drawings. It is for those who see that buildings
      now operate as systems, and that outcomes are shaped as much by data, flow, and intelligence as by
      materials and geometry.
    </p>
    <p>
      Tech-First Thinking starts where design-only thinking stops: with the outcomes a place must deliver.
      Throughput, comfort, reliability, clarity, revenue, safety, humanity — these are not aesthetic questions,
      they are system questions. And today, systems run on technology.
    </p>
    <p>
      This is one of the core tools of the <strong>Innovation Architect</strong> — a new kind of architect who
      integrates technology, behavior, and physical space to create environments that actually work.
      Innovation Architects don’t draw buildings first. They shape the conditions that make innovation possible:
      the flows, the frictions, the hidden constraints, the operational logic, and the technological leverage
      points that change what a project can become.
    </p>
    <p>
      Airports are the clearest proving ground. They expose everything: limits of space, limits of process,
      limits of comfort, limits of current systems. A Tech-First approach helps airport designers understand
      not just what a concourse <em>should look like</em>, but how it should perform — and how technology
      can unlock outcomes that drawings alone never could.
    </p>
    <p>
      This tool applies that method. Enter your project. It will interpret the context, identify leverage,
      ask one clarifying question, and generate a Tech-First strategy you can use with colleagues, clients,
      or on your own projects. It is not a design tool. It is a thinking tool.
    </p>
  </section>

  <hr class="divider" />

  <!-- STEP 1: PROJECT INPUTS -->
  <h2>Step 1 — Describe your airport project</h2>
  <form id="project-form">
    <label>
      Project name
      <input type="text" name="projectName" placeholder="e.g., LAX T7–T8 Refresh" required />
    </label>

    <label>
      Airport area / typology
      <select name="typology" required>
        <option value="">Select one…</option>
        <option>Terminal modernization</option>
        <option>New concourse</option>
        <option>Remote concourse / ADA-like</option>
        <option>Departures hall / check-in</option>
        <option>Security checkpoint</option>
        <option>Holdrooms / gate areas</option>
        <option>FIS / arrivals processing</option>
        <option>Curbside / landside</option>
        <option>Multi-area / system-wide</option>
        <option>Other airport facility</option>
      </select>
    </label>

    <label>
      Location / context
      <input
        type="text"
        name="location"
        placeholder="City, region, climate, aviation role (hub vs O&D), expected demand, major events (e.g., Olympics)."
        required
      />
    </label>

    <label>
      Primary users / stakeholders
      <textarea
        name="users"
        rows="2"
        placeholder="e.g., departing passengers, arriving passengers, airline staff, airport ops, TSA, CBP, concessions operators, etc."
        required
      ></textarea>
    </label>

    <label>
      Organizational goals (list as many as you like)
      <textarea
        name="goals"
        rows="3"
        placeholder="List goals from different stakeholders: operations, passenger experience, airlines, revenue, resilience, Skytrax/IATA targets, Olympics readiness, etc."
        required
      ></textarea>
    </label>

    <label>
      Time horizon
      <input
        type="text"
        name="timeHorizon"
        placeholder="e.g., Design for 2030, 10-year adaptability, opening by 2028 for Olympics."
      />
    </label>

    <label>
      Known / existing digital systems
      <textarea
        name="systems"
        rows="3"
        placeholder="BMS, FIDS, AODB, wayfinding, existing analytics dashboards, queue management, security systems, apps, etc. (as far as you know)."
      ></textarea>
    </label>

    <label>
      Key constraints / non-negotiables
      <textarea
        name="constraints"
        rows="3"
        placeholder="e.g., fixed footprint, limited budget, aggressive schedule, construction phasing with live operations, security and regulatory constraints, airline lease limits, etc."
      ></textarea>
    </label>

    <label>
      Current pain points / frustrations
      <textarea
        name="painPoints"
        rows="3"
        placeholder="What's broken or frustrating today? e.g., undersized holdrooms at peak, security queues exceeding targets, weak concessions spend, inconsistent passenger experience, etc."
      ></textarea>
    </label>

    <button type="submit">Continue</button>
  </form>

  <!-- STEP 2: CLARIFYING QUESTION -->
  <div id="question-step" class="hidden">
    <h2>Step 2 — Strategic clarification</h2>
    <div class="question-box">
      <div class="question-label">Tech-First Thinking™ asks:</div>
      <div id="clarifying-question" class="small"></div>
      <label style="margin-top: 1rem;">
        Your answer
        <textarea
          id="clarifying-answer"
          rows="3"
          placeholder="Answer this one question as specifically as you can. This will sharpen the airport strategy."
        ></textarea>
      </label>
    </div>
    <button id="generate-report-btn">Generate Tech-First Airport Report</button>
  </div>

  <!-- STATUS + OUTPUT + ACTIONS -->
  <div id="status"></div>

  <div id="output"></div>

  <div id="report-actions" class="hidden">
    <div class="inline-buttons">
      <button id="save-report-btn">Save to My Reports</button>
      <button id="download-report-btn">Download as Word (.doc)</button>
    </div>
    <p class="small" id="export-info"></p>
  </div>

  <!-- MY REPORTS SECTION -->
  <hr class="divider" />
  <section id="my-reports">
    <h2>My Reports</h2>
    <p class="small">
      Reports saved here stay in this browser only. You can reopen them and export them again later.
      Free tier: up to 5 Word exports per month per browser.
    </p>
    <div id="reports-list"></div>
  </section>

  <script>
    const form = document.getElementById('project-form');
    const statusEl = document.getElementById('status');
    const outputEl = document.getElementById('output');

    const questionStepEl = document.getElementById('question-step');
    const clarifyingQuestionEl = document.getElementById('clarifying-question');
    const clarifyingAnswerEl = document.getElementById('clarifying-answer');
    const generateReportBtn = document.getElementById('generate-report-btn');

    const reportActionsEl = document.getElementById('report-actions');
    const saveReportBtn = document.getElementById('save-report-btn');
    const downloadReportBtn = document.getElementById('download-report-btn');
    const exportInfoEl = document.getElementById('export-info');

    const reportsListEl = document.getElementById('reports-list');

    let storedPayload = null;
    let storedQuestion = null;
    let currentReport = null;

    // ----- UTILITIES -----

    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    function getCurrentMonthKey() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, "0");
      return `tft_export_count_${year}${month}`;
    }

    function getExportCount() {
      const key = getCurrentMonthKey();
      const val = localStorage.getItem(key);
      return val ? parseInt(val, 10) || 0 : 0;
    }

    function incrementExportCount() {
      const key = getCurrentMonthKey();
      const current = getExportCount();
      localStorage.setItem(key, String(current + 1));
    }

    function updateExportInfo() {
      const count = getExportCount();
      const remaining = Math.max(0, 5 - count);
      exportInfoEl.textContent = `Free tier: ${remaining} Word export${remaining === 1 ? "" : "s"} remaining this month on this browser (limit 5).`;
    }

    function getSavedReports() {
      const raw = localStorage.getItem("tft_saved_reports");
      if (!raw) return [];
      try {
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch {
        return [];
      }
    }

    function saveReportsToStorage(reports) {
      localStorage.setItem("tft_saved_reports", JSON.stringify(reports));
    }

    function renderReportsList() {
      const reports = getSavedReports();
      reportsListEl.innerHTML = "";

      if (reports.length === 0) {
        reportsListEl.innerHTML = '<p class="small">No reports saved yet.</p>';
        return;
      }

      reports.forEach((r, index) => {
        const div = document.createElement("div");
        div.className = "reports-list-item";

        const title = document.createElement("div");
        title.className = "reports-list-item-title";
        title.textContent = r.projectName || `Report ${index + 1}`;

        const meta = document.createElement("div");
        meta.className = "small";
        meta.textContent = r.createdAt
          ? `Created: ${new Date(r.createdAt).toLocaleString()}`
          : "";

        const buttonsDiv = document.createElement("div");
        buttonsDiv.className = "inline-buttons";

        const viewBtn = document.createElement("button");
        viewBtn.type = "button";
        viewBtn.textContent = "View";
        viewBtn.addEventListener("click", () => {
          currentReport = r.report;
          outputEl.textContent = r.report;
          reportActionsEl.classList.remove("hidden");
          statusEl.textContent = `Showing saved report: ${r.projectName || "Untitled"}`;
          updateExportInfo();
        });

        const downloadBtn = document.createElement("button");
        downloadBtn.type = "button";
        downloadBtn.textContent = "Download as Word";
        downloadBtn.addEventListener("click", () => {
          if (!canExport()) return;
          downloadAsWord(r.report, r.projectName);
        });

        buttonsDiv.appendChild(viewBtn);
        buttonsDiv.appendChild(downloadBtn);

        div.appendChild(title);
        div.appendChild(meta);
        div.appendChild(buttonsDiv);

        reportsListEl.appendChild(div);
      });
    }

    function canExport() {
      const count = getExportCount();
      if (count >= 5) {
        alert("Free tier limit reached: 5 Word exports this month on this browser.");
        return false;
      }
      return true;
    }

    function downloadAsWord(reportText, projectName) {
      const safeTitle = (projectName || "tech-first-report").replace(/[^\w\-]+/g, "_");
      const fileName = `${safeTitle}.doc`;

      const html =
        "<html><head><meta charset='utf-8'></head><body>" +
        "<pre style='font-family: Avenir, system-ui, sans-serif; white-space: pre-wrap;'>" +
        escapeHtml(reportText) +
        "</pre></body></html>";

      const blob = new Blob([html], { type: "application/msword" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      incrementExportCount();
      updateExportInfo();
    }

    // ----- INIT -----
    renderReportsList();
    updateExportInfo();

    // ----- STEP 1: submit project info and get a clarifying question -----
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = 'Analyzing your project… asking one strategic clarifying question.';
      outputEl.textContent = '';
      reportActionsEl.classList.add("hidden");
      questionStepEl.classList.add('hidden');
      clarifyingAnswerEl.value = '';

      const formData = new FormData(form);
      const payload = Object.fromEntries(formData.entries());
      storedPayload = payload; // store for later

      try {
        const res = await fetch('/.netlify/functions/generate-question', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        if (!res.ok) {
          const text = await res.text();
          throw new Error(text || 'Request failed');
        }

        const data = await res.json();
        const question = data.question || 'Before I proceed, what is the single most important thing I should know about this project?';

        storedQuestion = question;
        clarifyingQuestionEl.textContent = question;
        questionStepEl.classList.remove('hidden');
        statusEl.textContent = 'Answer the question below, then generate your report.';
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Error generating clarifying question. Please try again.';
      }
    });

    // ----- STEP 2: submit clarifying answer and generate report -----
    generateReportBtn.addEventListener('click', async () => {
      if (!storedPayload) {
        statusEl.textContent = 'Please complete Step 1 first.';
        return;
      }

      const clarifyingAnswer = clarifyingAnswerEl.value.trim();
      if (!clarifyingAnswer) {
        statusEl.textContent = 'Please answer the clarifying question before generating the report.';
        return;
      }

      statusEl.textContent = 'Generating Tech-First airport report… this may take a minute.';
      outputEl.textContent = '';
      reportActionsEl.classList.add("hidden");

      const payload = {
        ...storedPayload,
        clarifyingQuestion: storedQuestion || '',
        clarifyingAnswer,
      };

      try {
        const res = await fetch('/.netlify/functions/generate-report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        if (!res.ok) {
          const text = await res.text();
          throw new Error(text || 'Request failed');
        }

        const data = await res.json();
        currentReport = data.report || '';
        statusEl.textContent = 'Done.';
        outputEl.textContent = currentReport || '(No report returned)';

        if (currentReport) {
          reportActionsEl.classList.remove("hidden");
          updateExportInfo();
        }
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Error generating report. Check console or try again.';
      }
    });

    // ----- SAVE CURRENT REPORT -----
    saveReportBtn.addEventListener("click", () => {
      if (!currentReport) {
        alert("Generate a report first.");
        return;
      }
      const reports = getSavedReports();
      const projectNameInput = storedPayload?.projectName || "Untitled project";
      reports.push({
        projectName: projectNameInput,
        report: currentReport,
        createdAt: new Date().toISOString(),
      });
      saveReportsToStorage(reports);
      renderReportsList();
      alert("Report saved to this browser under 'My Reports'.");
    });

    // ----- DOWNLOAD CURRENT REPORT -----
    downloadReportBtn.addEventListener("click", () => {
      if (!currentReport) {
        alert("Generate a report first.");
        return;
      }
      if (!canExport()) return;
      const projectNameInput = storedPayload?.projectName || "tech-first-report";
      downloadAsWord(currentReport, projectNameInput);
    });
  </script>
</body>
</html>
